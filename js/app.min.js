!function(){var e=function(){function e(e,n){function t(e){var n=$(e).find("span.overflow_ellipsis").first().clone().text().trim().replace(/\r?\n/g,"");return"#"==n.substring(0,1)&&(n=n.substring(1).trim()),n}return t(e).localeCompare(t(n))}function n(n){var t=$("li",n);t.sort(e),n.empty(),t.each(function(e,t){n.append(t)})}function t(){TS.client.channel_pane.rebuildImList(),TS.client.channel_pane.rebuildGroupList(),TS.client.channel_pane.rebuildStarredList(),TS.client.channel_pane.rebuildChannelList()}function a(e){var n=window.localStorage.getItem(_+e);return n?JSON.parse(n):{icon:"",alias:""}}function i(e){var n=$("<div>").html(e),t=$("<li>",{id:"channel_info_change"}).html("<a>Set Channel Info</a>");return t.insertAfter(n.find("li.divider").first()),n.html()}function o(e,n){var t=$("<div>").html(e),i=t.find("a."+n+"_name").attr("href"),o=t.find("a."+n+"_name").data(n+"-id"),r="group"==n?"ts_icon_lock":"ts_icon_channel_pane_hash";try{var l=a(o);if(!l.icon&&!l.alias)return e;var s=t.find("span.overflow_ellipsis");s.empty();try{var c=$(TS.emoji.graphicReplace(l.icon,{force_img:!0}));c.attr("src")?c.css("margin","-2px 3px 0 "):c=$("<ts-icon>").attr("class",r+" prefix")}catch(d){c=$("<ts-icon>").attr("class",r+" prefix")}"group"==n&&t.find("ts-icon").first().remove();var m=l.alias?l.alias:i.split("/")[2];return s.prepend(c),s.append(m),t.html()}catch(d){return console.error(d),e}}function r(){for(var e={},n=Object.keys(window.localStorage),t=0;t<n.length;t++){var a=n[t];0==a.indexOf(_)&&(e[a]=JSON.parse(window.localStorage[a]))}return e}function l(){var e=JSON.stringify(r()),n=new Blob([e]),t=document.createEvent("HTMLEvents");t.initEvent("click"),$("<a>",{download:"slack-up."+TS.model.team.domain+".config.json",href:URL.createObjectURL(n)}).get(0).dispatchEvent(t)}function s(e){try{var n=e.target.files[0];if(null!=n){var a=new FileReader;a.addEventListener("load",function(e){for(var n=JSON.parse(e.target.result),a=Object.keys(n),i=0;i<a.length;i++){var o=a[i];0==o.indexOf(_)&&window.localStorage.setItem(o,JSON.stringify({icon:n[o].icon,alias:n[o].alias}))}t(),TS.ui.inline_saver.show({target:TS.generic_dialog.div.find("a#upload_conf_btn")})}),a.readAsText(n)}}catch(i){console.error(i)}}function c(){return'<p class="bold no_bottom_margin"><a id="download_conf_btn" class="bold">Export channel configuration file</a></p><p style="line-height:1.25rem;">Download all your channel settings to a json file. You can share this to others to sync their settings with yours.</p><p class="bold no_bottom_margin"><a id="upload_conf_btn" class="bold">Import channel setting json file</a></p><input type="file" style="display:none" id="import_json" accept=".json" /><p style="line-height: 1.25rem;margin-bottom:0">Upload <code>json</code> file and automatically update your channel aliases and icons</p>'}function d(){return'<p class="top_margin"><label for="ch_alias" class="inline_block">Sidebar Alias</label><input id="ch_alias" type="text" class="small"><span class="modal_input_note">Add channel alias. Set a custom sidebar name for this channel.</span></p><p class="top_margin"><label for="ch_icon" class="inline_block">Emoji Icon</label><input id="ch_icon" type="text" class="small"><span class="modal_input_note" id="ch_info_save_target">Change channel emoji icon. Paste your emoji code here like <code>:book:</code></span></p>'}function m(){TS.generic_dialog.start({title:"SlackUp Preferences",body:c(),show_cancel_button:!0,show_go_button:!1,esc_for_ok:!1,onShow:function(){TS.generic_dialog.div.find(".modal-footer").addClass("hidden")}}),TS.generic_dialog.div.find(".modal-body input#import_json").change(s)}function p(){TS.generic_dialog.start({title:"Set info for channel #"+TS.shared.getActiveModelOb().name,body:d(),show_cancel_button:!0,show_go_button:!0,go_button_text:"Save Settings",esc_for_ok:!1,onShow:function(){var e=TS.generic_dialog.div,n=a(TS.model.active_cid);e.find("#ch_alias").val($("<span>").html(n.alias).text()),e.find("#ch_icon").val(n.icon)},onGo:function(){var e=TS.generic_dialog.div,n=e.find("#ch_icon").val().trim(),a=e.find("#ch_alias").val().trim();window.localStorage.setItem(_+TS.model.active_cid,JSON.stringify({icon:TS.utility.htmlEntities(n),alias:TS.utility.htmlEntities(a)})),t()}})}var u="conf_hide_msg_ids",_="conf_sidebar_",h=TS.client.channel_pane.rebuildStarredList;TS.client.channel_pane.rebuildStarredList=function(){h(),n($("ul#starred-list"))};var f=TS.client.channel_pane.rebuildChannelList;TS.client.channel_pane.rebuildChannelList=function(){f(),n($("ul#channel-list"))};var g=TS.client.msg_pane.rebuildMsgs;TS.client.msg_pane.rebuildMsgs=function(){g();var e=$("div.day_container");e.length&&e.each(function(e,n){var t=$(n),a=t.find("div.day_msgs");a.length&&""!=a.first().html()||t.remove()})};var v=TS.templates.menu_channel_items;TS.templates.menu_channel_items=function(e){return i(v(e))};var S=TS.templates.menu_group_items;TS.templates.menu_group_items=function(e){return i(S(e))};var b=TS.templates.menu_message_action_items;TS.templates.menu_message_action_items=function(e){var n=$("<div>").html(b(e)),t=$("<li>",{id:"hide_link","class":"danger","data-ts-message-id":TS.templates.makeMsgDomId(e.msg.ts)}).html("<a>Hide message (for me)</a>");return n.find("li.divider").length||n.append($("<li>",{"class":"divider"})),n.append(t),n.html()};var T=TS.templates.member;TS.templates.member=function(e){var n=T(e),t=$("<div>").html(n),a=$("<img>");a.attr("src",e.member.profile.image_24),a.css("display","inline-block"),a.css("margin","0 0 5px 5px"),a.css("border-radius","3px"),a.css("height","20px"),a.css("width","20px");var i=t.find("i.slackbot_icon");return i.length?a.insertAfter($(i)):a.insertAfter(t.find("span.presence").first()),t.html()};var y=TS.templates.channel;TS.templates.channel=function(e){var n=y(e);return o(n,"channel")};var w=TS.templates.group;TS.templates.group=function(e){var n=w(e);return o(n,"group")};var k=TS.templates.message;TS.templates.message=function(e){var n=k(e),t=$("<div>").html(n),a=t.find("ts-message").first().attr("id"),i=JSON.parse(window.localStorage.getItem(u));return i&&i.hasOwnProperty(a)&&i[a]?"":n};var x=TS.templates.channel_header;TS.templates.channel_header=function(e){var n=$("<div>").html(x(e));if(boot_data.hasOwnProperty("other_accounts")&&Object.keys(boot_data.other_accounts).length){var t=$("<div>",{"class":"team_list_info",style:"background:#FFF"}),a=Object.keys(boot_data.other_accounts);a.forEach(function(e){var n='<a class="blue_hover channel_actions_toggle channel_header_icon ts_tip ts_tip_bottom" href="'+boot_data.other_accounts[e].team_url+'" target="_blank"><span class="ts_tip_tip">'+boot_data.other_accounts[e].team_name+'</span><img style="border-radius:3px;width:24px;height:24px;margin:4px 3px 0 0" src="'+boot_data.other_accounts[e].team_icon.image_34+'"></a>';t.append(n)}),t.append('<div class="divider_bar">'),n.append(t)}return n.html()};var O=TS.menu.startWithTeamAndUser;TS.menu.startWithTeamAndUser=function(e){O(e);var n=$("section.slack_menu_you ul.menu_list"),t=$("<li>",{id:"import_export_dialog",role:"menuitem"}),a=$("<a>");a.html("SlackUp Preferences"),t.append(a),n.append(t)},$(document.body).on("click",'[id="channel_info_change"]',function(e){e.preventDefault(),TS.menu.end(),p()}),$(document.body).on("click",'[id="hide_link"]',function(e){var n=$(this).data("ts-message-id"),t=JSON.parse(window.localStorage.getItem(u));t=t?t:{},t[n]=!0,window.localStorage.setItem(u,JSON.stringify(t)),TS.client.msg_pane.rebuildMsgs()}),$(document.body).on("click",'[id="import_export_dialog"]',function(e){e.preventDefault(),clearTimeout(TS.menu.end_time),TS.menu.end(),m()}),$(document.body).on("click",'[id="download_conf_btn"]',function(e){e.preventDefault(),l()}),$(document.body).on("click",'[id="upload_conf_btn"]',function(e){e.preventDefault(),$("input#import_json").trigger("click")}),t()},n=document.createElement("script");n.type="text/javascript",n.innerHTML="("+e.toString()+")();",document.body.appendChild(n)}();