!function(){var e=function(){function e(e){var t=window.localStorage.getItem(m+e);return t?JSON.parse(t):{icon:"",alias:""}}function t(e){var t=$("<div>").html(e),n=$("<li>",{id:"channel_pref_change"}).html("<a>Channel preferences ...</a>");return n.insertAfter(t.find("li.divider").first()),t.html()}function n(t,n){var a=!1,i=$("<div>").html(t),o=i.find("a."+n+"_name").attr("href"),s=i.find("a."+n+"_name").data(n+"-id");try{var r=e(s);if(!r.icon&&!r.alias)return t;var l=i.find("span.overflow_ellipsis");l.empty();try{var c=$(TS.emoji.graphicReplace(r.icon,{force_img:!0}));c.attr("src")&&(c.css("margin","-2px 3px 0 0"),a=!0)}catch(d){}a&&i.find("ts-icon").first().remove();var u=r.alias?r.alias:o.split("/")[2];return l.prepend(c),l.append(u),i.html()}catch(d){return t}}function a(){for(var e={},t=Object.keys(window.localStorage),n=0;n<t.length;n++){var a=t[n];0==a.indexOf(m)&&(e[a]=JSON.parse(window.localStorage[a]))}return e}function i(){var e=JSON.stringify(a()),t=new Blob([e]),n=document.createEvent("HTMLEvents");n.initEvent("click"),$("<a>",{download:"slackup."+TS.model.team.domain+".config.json",href:URL.createObjectURL(t)}).get(0).dispatchEvent(n)}function o(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var a=t[n];0==a.indexOf(m)&&window.localStorage.setItem(a,JSON.stringify({icon:e[a].icon,alias:e[a].alias}))}TS.client.channel_pane.rebuild()}function s(e){try{var t=e.target.files[0];if(null!=t){var n=new FileReader;n.addEventListener("load",function(e){o(JSON.parse(e.target.result))}),n.readAsText(t)}}catch(a){console.error(a)}}function r(){var e=$("#fs_modal").find(".contents");e.html(c),e.find("input#import_json").change(s)}function l(){return'<p class="top_margin"><label for="ch_alias" class="inline_block">Sidebar Alias</label><input id="ch_alias" type="text" class="small"><span class="modal_input_note">Add channel alias. Set a custom sidebar name for this channel.</span></p><p class="top_margin"><label for="ch_icon" class="inline_block">Emoji Icon</label><input id="ch_icon" type="text" class="small"><span class="modal_input_note" id="ch_info_save_target">Change channel emoji icon. Paste your emoji code here like <code>:book:</code></span></p>'}function c(){var e='<h2 id="prefs_slackup_local" class="inline_block">File Options</h2><p><a href="#" id="download_conf_btn" class="bold"><i class="ts_icon ts_icon_download ts_icon_inherit"></i> Download</a> all your channel settings to a json file. You can share this to others to sync  their settings with yours.</p><input data-inline-saver="#prefs_slackup_local" type="file" style="display:none" id="import_json" accept=".json" /><a id="upload_conf_btn" class="bold" data-inline-saver="#prefs_slackup_local"><i class="ts_icon ts_icon_upload ts_icon_inherit"></i> Upload</a> a json configuration file and automatically update your channel aliases and icons</p><hr/><h2 id="prefs_slackup_online" class="inline_block small_bottom_margin">Slackup Connect!</h2>';if(null!==window.localStorage.getItem(_)){var t=$(TS.emoji.graphicReplace(":sunglasses:",{force_img:!0}));t.addClass("emoji-sizer"),slackupApiData=JSON.parse(window.localStorage.getItem(_)),e+="<p>Heads up! <code>"+slackupApiData.userEmail+'</code> <small><a href="#" id="unlinkSlackupConnect">unlink</a></small><br/><input type="hidden" id="slackupApiToken" value="'+slackupApiData.apiToken+'" />With slackup connect! you can easily restore you previous setting or backup your current configuration instantly. No more hassle to download, upload and share files. Just a few clicks away and you are ready to go! '+t[0].outerHTML+'<br/><br/><button class="btn btn-sc" id="slackupBackup" data-loading-text="Creating backup ..."style="min-width:200px">Backup Now</button><br/><br/><button class="btn btn-sc btn_info" data-loading-text="Restoring data ..." id="slackupRestore" style="min-width:200px">Restore Settings</button>'}else e+='<p>Login to Slackup Connect! to backup or restore your current setting online.</p><button id="slack-up-gauth" class="btn">Login using Google</button><br/>';return e}function d(){channelPrefifx=TS.shared.getActiveModelOb().is_group?"":"#",TS.generic_dialog.start({title:"Channel Preferences: "+channelPrefifx+TS.shared.getActiveModelOb().name,body:l(),show_cancel_button:!0,show_go_button:!0,go_button_text:"Save Settings",esc_for_ok:!0,onShow:function(){var t=TS.generic_dialog.div,n=e(TS.model.active_cid);t.find("#ch_alias").val($("<span>").html(n.alias).text()),t.find("#ch_icon").val(n.icon)},onGo:function(){var e=TS.generic_dialog.div,t=e.find("#ch_icon").val().trim(),n=e.find("#ch_alias").val().trim();window.localStorage.setItem(m+TS.model.active_cid,JSON.stringify({icon:TS.utility.htmlEntities(t),alias:TS.utility.htmlEntities(n)})),TS.client.channel_pane.rebuild()}})}var u=["slackup_settings","channel_pref_change"],p="https://slackup.marlosoft.net",m="conf_sidebar_",f="conf_hide_msg_ids",_="conf_slackup_api_conf",h=null,g=TS.error;TS.error=function(){for(var e in u)if(arguments[0].indexOf(u[e])>-1)return;g(arguments[0])};TS.warn;TS.warn=function(){for(var e in u)if(arguments[0].indexOf(u[e])>-1)return;g(arguments[0])};var b=TS.client.channel_pane.rebuild;TS.client.channel_pane.rebuild=function(){var e=["starred","channels","ims"];e=0==arguments.length?e:arguments,b.apply(this,e)};var v=TS.client.msg_pane.rebuildMsgs;TS.client.msg_pane.rebuildMsgs=function(){v();var e=$("div.day_container");e.length&&e.each(function(e,t){var n=$(t),a=n.find("div.day_msgs");a.length&&""!=a.first().html()||n.remove()})};var S=TS.templates.menu_channel_items;TS.templates.menu_channel_items=function(e){return t(S(e))};var k=TS.templates.menu_group_items;TS.templates.menu_group_items=function(e){return t(k(e))};var y=TS.templates.menu_message_action_items;TS.templates.menu_message_action_items=function(e){var t=$("<div>").html(y(e));if(t.find("#delete_link").length>0)return t.html();var n=$("<li>",{id:"hide_link","class":"danger","data-ts-message-id":TS.templates.makeMsgDomId(e.msg.ts)}).html("<a>Hide message (for me)</a>");return t.find("li.divider").length||t.append($("<li>",{"class":"divider"})),t.append(n),t.html()};var T=TS.templates.member;TS.templates.member=function(e){var t=T(e),n=$("<div>").html(t),a=$("<img>");a.attr("src",e.member.profile.image_24),a.css("display","inline-block"),a.css("margin","0 0 5px 5px"),a.css("border-radius","3px"),a.css("height","20px"),a.css("width","20px");var i=n.find("i.slackbot_icon");return i.length?a.insertAfter($(i)):a.insertAfter(n.find("span.presence").first()),n.html()};var w=TS.templates.channel;TS.templates.channel=function(e){var t=w(e);return n(t,"channel")};var O=TS.templates.group;TS.templates.group=function(e){var t=O(e);return n(t,"group")};var x=TS.templates.message;TS.templates.message=function(e){var t=x(e),n=$("<div>").html(t),a=n.find("ts-message").first().attr("id"),i=JSON.parse(window.localStorage.getItem(f));return i&&i.hasOwnProperty(a)&&i[a]?"":t};var j=TS.templates.channel_header;TS.templates.channel_header=function(e){var t=$("<div>").html(j(e));if(boot_data.hasOwnProperty("other_accounts")&&Object.keys(boot_data.other_accounts).length){var n=$("<div>",{"class":"team_list_info",style:"background:#FFF"}),a=Object.keys(boot_data.other_accounts);a.forEach(function(e){var t='<a class="blue_hover channel_actions_toggle channel_header_icon ts_tip ts_tip_bottom" href="'+boot_data.other_accounts[e].team_url+'" target="_blank"><span class="ts_tip_tip">'+boot_data.other_accounts[e].team_name+'</span><img style="border-radius:3px;width:24px;height:24px;margin:4px 3px 0 0" src="'+boot_data.other_accounts[e].team_icon.image_34+'"></a>';n.append(t)}),n.append('<div class="divider_bar">'),t.append(n)}return t.html()};var N=TS.ui.prefs_dialog.start;TS.ui.prefs_dialog.start=function(e,t,n){e=null==e?"notifications":e,N(e,t,n)};var J=TS.templates.prefs_sidebar;TS.templates.prefs_sidebar=function(e,t){var n=J(e,t);return n+='<li><a data-section="slackup_settings" class="sidebar_menu_list_item" >Slackup Options</a></li>'},$(document.body).on("click",'[id="channel_pref_change"]',function(e){e.preventDefault(),TS.menu.end(),d()}),$(document.body).on("click",'[id="hide_link"]',function(e){var t=$(this).data("ts-message-id"),n=JSON.parse(window.localStorage.getItem(f));n=n?n:{},n[t]=!0,window.localStorage.setItem(f,JSON.stringify(n)),TS.client.msg_pane.rebuildMsgs()}),$(document.body).on("click",'[id="download_conf_btn"]',function(e){e.preventDefault(),i()}),$(document.body).on("click",'[id="upload_conf_btn"]',function(e){e.preventDefault(),$("input#import_json").trigger("click")}),$(document.body).on("click",'[data-section="slackup_settings"]',function(e){e.preventDefault(),r()}),$(document.body).on("click","button#slack-up-gauth",function(e){e.preventDefault(),$(this).prop("enabled",!1);var t=500,n=500,a=screen.width/2-t/2,i=screen.height/2-n/2,o="Slack-Up Connect!",s="toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+t+", height="+n+", top="+i+", left="+a;h=window.open(p+"/auth/connect/",o,s),h.focus()}),$(document.body).on("click","a#unlinkSlackupConnect",function(e){e.preventDefault();var t=confirm("Are you sure to unlink this account?");t&&(window.localStorage.removeItem(_),r())}),$(document.body).on("click","button#slackupBackup",function(e){e.preventDefault();var t=btoa(TS.model.team.id),n=$("button.btn-sc"),i=$("button#slackupBackup"),o=JSON.parse(window.localStorage.getItem(_)),s={token:o.apiToken,json:JSON.stringify(a())};n.attr("disabled","disabled"),i.button("loading"),$.post(p+"/backup/team/"+t,s,function(e){TS.ui.inline_saver.show({target:i,hide_msg:!0}),n.removeAttr("disabled"),i.button("reset"),TS.info("slackup setting has been successfully backuped")}).fail(function(e){i.button("reset"),n.removeAttr("disabled"),alert(e.responseJSON.message),TS.error(e.responseJSON.message)})}),$(document.body).on("click","button#slackupRestore",function(e){e.preventDefault();var t=btoa(TS.model.team.id),n=$("button.btn-sc"),a=$("button#slackupRestore"),i=JSON.parse(window.localStorage.getItem(_)),s={token:i.apiToken};n.attr("disabled","disabled"),a.button("loading"),$.get(p+"/restore/team/"+t,s,function(e){o(e),TS.ui.inline_saver.show({target:a}),n.removeAttr("disabled"),a.button("reset"),TS.info("slackup setting has been successfully restored")}).fail(function(e){a.button("reset"),n.removeAttr("disabled"),alert(e.responseJSON.message),TS.error(e.responseJSON.message)})}),$(window).on("message",function(e){null!==h&&h.close();var t=e.originalEvent.data;if(null!=t){JSON.parse(t);window.localStorage.setItem(_,t),r()}})},t=document.createElement("script");t.type="text/javascript",t.innerHTML="("+e.toString()+")();",document.body.appendChild(t)}();