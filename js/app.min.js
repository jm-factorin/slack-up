!function(){var e=function(){function e(e,t){function n(e){var t=$(e).find("span.overflow_ellipsis").first().clone().text().trim().replace(/\r?\n/g,"");return"#"==t.substring(0,1)&&(t=t.substring(1).trim()),t}return n(e).localeCompare(n(t))}function t(t){var n=$("li",t);n.sort(e),t.empty(),n.each(function(e,n){t.append(n)})}function n(){TS.client.channel_pane.rebuildStarredList(),TS.client.channel_pane.rebuildPublicPrivateChannelsList()}function a(e){var t=window.localStorage.getItem(h+e);return t?JSON.parse(t):{icon:"",alias:""}}function i(e){var t=$("<div>").html(e),n=$("<li>",{id:"channel_pref_change"}).html("<a>Channel preferences ...</a>");return n.insertAfter(t.find("li.divider").first()),t.html()}function o(e,t){var n=$("<div>").html(e),i=n.find("a."+t+"_name").attr("href"),o=n.find("a."+t+"_name").data(t+"-id"),s="group"==t?"ts_icon_lock":"ts_icon_channel_pane_hash";try{var r=a(o);if(!r.icon&&!r.alias)return e;var l=n.find("span.overflow_ellipsis");l.empty();try{var c=$(TS.emoji.graphicReplace(r.icon,{force_img:!0}));c.attr("src")?c.css("margin","-2px 3px 0 "):c=$("<ts-icon>").attr("class",s+" prefix")}catch(d){c=$("<ts-icon>").attr("class",s+" prefix")}"group"==t&&n.find("ts-icon").first().remove();var u=r.alias?r.alias:i.split("/")[2];return l.prepend(c),l.append(u),n.html()}catch(d){return e}}function s(){for(var e={},t=Object.keys(window.localStorage),n=0;n<t.length;n++){var a=t[n];0==a.indexOf(h)&&(e[a]=JSON.parse(window.localStorage[a]))}return e}function r(){var e=JSON.stringify(s()),t=new Blob([e]),n=document.createEvent("HTMLEvents");n.initEvent("click"),$("<a>",{download:"slack-up."+TS.model.team.domain+".config.json",href:URL.createObjectURL(t)}).get(0).dispatchEvent(n)}function l(e){for(var t=Object.keys(e),a=0;a<t.length;a++){var i=t[a];0==i.indexOf(h)&&window.localStorage.setItem(i,JSON.stringify({icon:e[i].icon,alias:e[i].alias}))}n()}function c(e){try{var t=e.target.files[0];if(null!=t){var n=new FileReader;n.addEventListener("load",function(e){l(JSON.parse(e.target.result))}),n.readAsText(t)}}catch(a){console.error(a)}}function d(){var e=$("#fs_modal").find(".contents");e.html(p),e.find("input#import_json").change(c)}function u(){return'<p class="top_margin"><label for="ch_alias" class="inline_block">Sidebar Alias</label><input id="ch_alias" type="text" class="small"><span class="modal_input_note">Add channel alias. Set a custom sidebar name for this channel.</span></p><p class="top_margin"><label for="ch_icon" class="inline_block">Emoji Icon</label><input id="ch_icon" type="text" class="small"><span class="modal_input_note" id="ch_info_save_target">Change channel emoji icon. Paste your emoji code here like <code>:book:</code></span></p>'}function p(){var e='<h2 id="prefs_slackup_local" class="inline_block">File Options</h2><p><a href="#" id="download_conf_btn" class="bold"><i class="ts_icon ts_icon_download ts_icon_inherit"></i> Download</a> all your channel settings to a json file. You can share this to others to sync  their settings with yours.</p><input data-inline-saver="#prefs_slackup_local" type="file" style="display:none" id="import_json" accept=".json" /><a id="upload_conf_btn" class="bold" data-inline-saver="#prefs_slackup_local"><i class="ts_icon ts_icon_upload ts_icon_inherit"></i> Upload</a> a json configuration file and automatically update your channel aliases and icons</p><hr/><h2 id="prefs_slackup_online" class="inline_block small_bottom_margin">Slackup Connect!</h2>';if(null!==window.localStorage.getItem(b)){var t=$(TS.emoji.graphicReplace(":sunglasses:",{force_img:!0}));t.addClass("emoji-sizer"),slackupApiData=JSON.parse(window.localStorage.getItem(b)),e+="<p>Heads up! <code>"+slackupApiData.userEmail+'</code> <small><a href="#" id="unlinkSlackupConnect">unlink</a></small><br/><input type="hidden" id="slackupApiToken" value="'+slackupApiData.apiToken+'" />With slackup connect! you can easily restore you previous setting or backup your current configuration instantly. No more hassle to download, upload and share files. Just a few clicks away and you are ready to go! '+t[0].outerHTML+'<br/><br/><button class="btn btn-sc" id="slackupBackup" data-loading-text="Creating backup ..."style="min-width:200px">Backup Now</button><br/><br/><button class="btn btn-sc btn_info" data-loading-text="Restoring data ..." id="slackupRestore" style="min-width:200px">Restore Settings</button>'}else e+='<p>Login to Slackup Connect! to backup or restore your current setting online.</p><button id="slack-up-gauth" class="btn">Login using Google</button><br/>';return e}function m(){channelPrefifx=TS.shared.getActiveModelOb().is_group?"":"#",TS.generic_dialog.start({title:"Channel Preferences: "+channelPrefifx+TS.shared.getActiveModelOb().name,body:u(),show_cancel_button:!0,show_go_button:!0,go_button_text:"Save Settings",esc_for_ok:!0,onShow:function(){var e=TS.generic_dialog.div,t=a(TS.model.active_cid);e.find("#ch_alias").val($("<span>").html(t.alias).text()),e.find("#ch_icon").val(t.icon)},onGo:function(){var e=TS.generic_dialog.div,t=e.find("#ch_icon").val().trim(),a=e.find("#ch_alias").val().trim();window.localStorage.setItem(h+TS.model.active_cid,JSON.stringify({icon:TS.utility.htmlEntities(t),alias:TS.utility.htmlEntities(a)})),n()}})}var f=["slackup_settings","channel_pref_change"],_="https://slackup.marlosoft.net",h="conf_sidebar_",g="conf_hide_msg_ids",b="conf_slackup_api_conf",v=null,S=TS.error;TS.error=function(){for(var e in f)if(arguments[0].indexOf(f[e])>-1)return;S(arguments[0])};TS.warn;TS.warn=function(){for(var e in f)if(arguments[0].indexOf(f[e])>-1)return;S(arguments[0])};var k=TS.client.channel_pane.rebuildStarredList;TS.client.channel_pane.rebuildStarredList=function(){k(),t($("ul#starred-list"))};var y=TS.client.channel_pane.rebuildPublicPrivateChannelsList;TS.client.channel_pane.rebuildPublicPrivateChannelsList=function(){y(),t($("ul#channel-list"))};var T=TS.client.msg_pane.rebuildMsgs;TS.client.msg_pane.rebuildMsgs=function(){T();var e=$("div.day_container");e.length&&e.each(function(e,t){var n=$(t),a=n.find("div.day_msgs");a.length&&""!=a.first().html()||n.remove()})};var w=TS.templates.menu_channel_items;TS.templates.menu_channel_items=function(e){return i(w(e))};var O=TS.templates.menu_group_items;TS.templates.menu_group_items=function(e){return i(O(e))};var x=TS.templates.menu_message_action_items;TS.templates.menu_message_action_items=function(e){var t=$("<div>").html(x(e)),n=$("<li>",{id:"hide_link","class":"danger","data-ts-message-id":TS.templates.makeMsgDomId(e.msg.ts)}).html("<a>Hide message (for me)</a>");return t.find("li.divider").length||t.append($("<li>",{"class":"divider"})),t.append(n),t.html()};var j=TS.templates.member;TS.templates.member=function(e){var t=j(e),n=$("<div>").html(t),a=$("<img>");a.attr("src",e.member.profile.image_24),a.css("display","inline-block"),a.css("margin","0 0 5px 5px"),a.css("border-radius","3px"),a.css("height","20px"),a.css("width","20px");var i=n.find("i.slackbot_icon");return i.length?a.insertAfter($(i)):a.insertAfter(n.find("span.presence").first()),n.html()};var N=TS.templates.channel;TS.templates.channel=function(e){var t=N(e);return o(t,"channel")};var J=TS.templates.group;TS.templates.group=function(e){var t=J(e);return o(t,"group")};var A=TS.templates.message;TS.templates.message=function(e){var t=A(e),n=$("<div>").html(t),a=n.find("ts-message").first().attr("id"),i=JSON.parse(window.localStorage.getItem(g));return i&&i.hasOwnProperty(a)&&i[a]?"":t};var C=TS.templates.channel_header;TS.templates.channel_header=function(e){var t=$("<div>").html(C(e));if(boot_data.hasOwnProperty("other_accounts")&&Object.keys(boot_data.other_accounts).length){var n=$("<div>",{"class":"team_list_info",style:"background:#FFF"}),a=Object.keys(boot_data.other_accounts);a.forEach(function(e){var t='<a class="blue_hover channel_actions_toggle channel_header_icon ts_tip ts_tip_bottom" href="'+boot_data.other_accounts[e].team_url+'" target="_blank"><span class="ts_tip_tip">'+boot_data.other_accounts[e].team_name+'</span><img style="border-radius:3px;width:24px;height:24px;margin:4px 3px 0 0" src="'+boot_data.other_accounts[e].team_icon.image_34+'"></a>';n.append(t)}),n.append('<div class="divider_bar">'),t.append(n)}return t.html()};var I=TS.ui.prefs_dialog.start;TS.ui.prefs_dialog.start=function(e,t,n){e=null==e?"notifications":e,I(e,t,n)};var L=TS.templates.prefs_sidebar;TS.templates.prefs_sidebar=function(e,t){var n=L(e,t);return n+='<li><a data-section="slackup_settings">Slackup Options</a></li>'},$(document.body).on("click",'[id="channel_pref_change"]',function(e){e.preventDefault(),TS.menu.end(),m()}),$(document.body).on("click",'[id="hide_link"]',function(e){var t=$(this).data("ts-message-id"),n=JSON.parse(window.localStorage.getItem(g));n=n?n:{},n[t]=!0,window.localStorage.setItem(g,JSON.stringify(n)),TS.client.msg_pane.rebuildMsgs()}),$(document.body).on("click",'[id="download_conf_btn"]',function(e){e.preventDefault(),r()}),$(document.body).on("click",'[id="upload_conf_btn"]',function(e){e.preventDefault(),$("input#import_json").trigger("click")}),$(document.body).on("click",'[data-section="slackup_settings"]',function(e){e.preventDefault(),d()}),$(document.body).on("click","button#slack-up-gauth",function(e){e.preventDefault(),$(this).prop("enabled",!1);var t=500,n=500,a=screen.width/2-t/2,i=screen.height/2-n/2,o="Slack-Up Connect!",s="toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+t+", height="+n+", top="+i+", left="+a;v=window.open(_+"/auth/connect/",o,s),v.focus()}),$(document.body).on("click","a#unlinkSlackupConnect",function(e){e.preventDefault();var t=confirm("Are you sure to unlink this account?");t&&(window.localStorage.removeItem(b),d())}),$(document.body).on("click","button#slackupBackup",function(e){e.preventDefault();var t=btoa(TS.model.team.id),n=$("button.btn-sc"),a=$("button#slackupBackup"),i=JSON.parse(window.localStorage.getItem(b)),o={token:i.apiToken,json:JSON.stringify(s())};n.attr("disabled","disabled"),a.button("loading"),$.post(_+"/backup/team/"+t,o,function(e){TS.ui.inline_saver.show({target:a,hide_msg:!0}),n.removeAttr("disabled"),a.button("reset"),TS.info("slackup setting has been successfully backuped")}).fail(function(e){a.button("reset"),n.removeAttr("disabled"),alert(e.responseJSON.message),TS.error(e.responseJSON.message)})}),$(document.body).on("click","button#slackupRestore",function(e){e.preventDefault();var t=btoa(TS.model.team.id),n=$("button.btn-sc"),a=$("button#slackupRestore"),i=JSON.parse(window.localStorage.getItem(b)),o={token:i.apiToken};n.attr("disabled","disabled"),a.button("loading"),$.get(_+"/restore/team/"+t,o,function(e){l(e),TS.ui.inline_saver.show({target:a}),n.removeAttr("disabled"),a.button("reset"),TS.info("slackup setting has been successfully restored")}).fail(function(e){a.button("reset"),n.removeAttr("disabled"),alert(e.responseJSON.message),TS.error(e.responseJSON.message)})}),$(window).on("message",function(e){null!==v&&v.close();var t=e.originalEvent.data;if(null!=t){JSON.parse(t);window.localStorage.setItem(b,t),d()}})},t=document.createElement("script");t.type="text/javascript",t.innerHTML="("+e.toString()+")();",document.body.appendChild(t)}();