!function(){var e=function(){function e(e){var t=$("li.channel",e);t.sort(function(e,t){function a(e){var t=$(e).find("span.overflow_ellipsis").first().clone().text().trim().replace(/\r?\n/g,"");return"#"==t.substring(0,1)&&(t=t.substring(1).trim()),t}return a(e)>a(t)}),e.empty(),t.each(function(t,a){e.append(a)})}function t(){TS.client.channel_pane.rebuildStarredList(),TS.client.channel_pane.rebuildChannelList()}var a="conf_hide_msg_ids",n={escape:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},getData:function(e){var t=window.localStorage.getItem(n.getChannelKey(e));return t?JSON.parse(t):{icon:"",alias:""}},getChannelKey:function(e){return"conf_sidebar_"+e},html:function(){return'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button><h3>Set info for channel #<span id="ch_title"></span></h3></div><div class="modal-body"><p>Change channel emoji icon. Paste your emoji name here like <code>:book:</code></p><input type="text" id="ch_icon" value="" class="with-emoji-menu" style="display:inline-block; width: 100%"/><p style="margin-top: 20px">Add channel alias. Set a custom sidebar name for this channel</p><input type="text" id="ch_alias" value="" style="display:inline-block; width: 100%"/></p></div><div class="modal-footer"><a class="btn btn_save">Save</a></div>'},show:function(e){var a=$("div#change_icon_dialog");a.length||(a=$("<div>",{id:"change_icon_dialog","class":"modal hide fade in","aria-hidden":"false"}).html(n.html()),$(document.body).append(a));var i=n.getData(TS.model.active_cid);a.find("#ch_icon").val(i.icon),a.find("#ch_alias").val($("<span>").html(i.alias).text()),a.find("span#ch_title").text(e),a.find("span.ch_preview").click(function(e){TS.emoji_menu.startEmo(e,"#ch_icon")}),a.find("a.btn_save").click(function(e){e.preventDefault(),window.localStorage.setItem(n.getChannelKey(TS.model.active_cid),JSON.stringify({icon:n.escape($("#ch_icon").val().trim()),alias:n.escape($("#ch_alias").val().trim())})),t(),a.modal("hide")}),a.modal("show")}},i=TS.client.channel_pane.rebuildStarredList;TS.client.channel_pane.rebuildStarredList=function(){i(),e($("ul#starred-list"))};var s=TS.client.channel_pane.rebuildChannelList;TS.client.channel_pane.rebuildChannelList=function(){s(),e($("ul#channel-list"))};var r=TS.client.msg_pane.rebuildMsgs;TS.client.msg_pane.rebuildMsgs=function(){r();var e=$("div.day_container");e.length&&e.each(function(e,t){var a=$(t);""==a.find("div.day_msgs").first().html()&&a.remove()})};var l=TS.templates.menu_channel_items;TS.templates.menu_channel_items=function(e){var t=$("<div>").html(l(e)),a=$("<li>",{id:"channel_info_change"}).html("<a>Set Channel Info</a>");return a.insertAfter(t.find("li.divider").first()),t.html()};var c=TS.templates.builders.buildMsgHTML;TS.templates.builders.buildMsgHTML=function(e,t){var a=c(e,t);try{var n=$("<div>").html(a),i=n.find("ts-message").first().attr("id"),s=n.find("a.message_sender").attr("href"),r=n.find("div.action_hover_container");if(s){var l=$("<a>").attr("data-action","mention").attr("data-user",s.split("/")[2]).addClass("ts_icon ts_icon_mentions").addClass("ts_tip ts_tip_top ts_tip_float ts_tip_delay_600 ts_tip_hidden").append($("<span>").addClass("ts_tip_tip").html("Mention"));r.prepend(l)}var d=$("<a>").attr("data-action","hide").attr("data-ts-message-id",i).addClass("ts_icon ts_icon_archive").addClass("ts_tip ts_tip_top ts_tip_float ts_tip_delay_600 ts_tip_hidden").append($("<span>").addClass("ts_tip_tip").html("Hide for me"));return d.insertAfter(r.find('a[data-action="copy_link"]')),n.html()}catch(o){return console.error(o),a}};var d=TS.templates.member;TS.templates.member=function(e){var t=d(e),a=$("<div>").html(t),n=$("<img>");n.css("display","inline-block"),n.css("margin","0 0 5px 5px"),n.css("border-radius","3px"),n.css("height","20px"),n.css("width","20px");var i=a.find("span.presence")[0],s=a.find("i.slackbot_icon")[0];if(s)n.attr("src","https://slack.global.ssl.fastly.net/66f9/img/slackbot_24.png"),n.insertAfter($(s));else{var r=TS.members.getMemberById($(i).data("member-presence"));n.attr("src",r.profile.image_24),n.insertAfter($(i))}return a.html()};var o=TS.templates.channel;TS.templates.channel=function(e){var t=o(e),a=$("<div>").html(t),i=a.find("a.channel_name").data("channel-id"),s=a.find("a.channel_name").attr("href");try{var r=n.getData(i);if(!r.icon&&!r.alias)return t;var l=a.find("span.overflow_ellipsis");l.empty();try{var c=$(TS.emoji.graphicReplace(r.icon,{force_img:!0}));c.attr("src")?c.css("margin","-2px 3px 0 "):c=$('<span class="prefix"># </span>')}catch(d){c=$('<span class="prefix"># </span>')}var p=r.alias?r.alias:s.split("/")[2];return l.prepend(c),l.append(p),a.html()}catch(d){return console.error(d),t}};var p=TS.templates.message;TS.templates.message=function(e){var t=p(e),n=$("<div>").html(t),i=n.find("ts-message").first().attr("id"),s=JSON.parse(window.localStorage.getItem(a));return s&&s.hasOwnProperty(i)&&s[i]?"":t},$(document.body).on("click",'[id="channel_info_change"]',function(e){e.preventDefault(),n.show(TS.menu.channel.name),TS.menu.end()}),$(document.body).on("click",'[data-action="mention"]',function(e){var t=$("textarea#message-input");if(!t.prop("disabled")){var a=t.val()+"@"+$(e.target).data("user");t.val(a.trim()+" ").trigger("autosize").trigger("autosize-resize").focus()}}),$(document.body).on("click",'[data-action="hide"]',function(e){var t=$(e.target).data("ts-message-id"),n=JSON.parse(window.localStorage.getItem(a));n=n?n:{},n[t]=!0,window.localStorage.setItem(a,JSON.stringify(n)),TS.client.msg_pane.rebuildMsgs()}),t()},t=document.createElement("script");t.type="text/javascript",t.innerHTML="("+e.toString()+")();",document.body.appendChild(t)}();